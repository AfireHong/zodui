<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='UTF-8' />
  <meta name='viewport' content='width=device-width, initial-scale=1.0' />
  <link rel='alternate icon' class='js-site-favicon' type='image/png' href='/zodui.png'>
  <link rel='icon' class='js-site-favicon' type='image/svg+xml' href='/zodui.svg'>
  <title>Zod UI</title>
  <style data-name='message'>
    div.message {
      position: fixed;
      top: 10px;
      left: 50%;
      transform: translate(-50%, -150%);
      padding: 1em;
      background-color: #fff;
      border: 1px solid #ccc;
      border-radius: 5px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
      opacity: 0;
      transition: 0.3s ease-in-out;
    }
    div.message.show {
      opacity: 1;
      transform: translateX(-50%);
    }
  </style>
  <style data-name='main'>
    body {
      display: flex;
      margin: 0;
      padding-top: 60px;
    }
    #container {
      width: 500px;
    }
    #root {
      width: calc(100% - 500px);
      height: calc(100vh - 60px);
      overflow: overlay;
    }
  </style>
  <style data-name='header'>
    body > .header {
      position: absolute;
      top: 0;
      left: 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 5px 30px;
      width: calc(100vw - 60px);
      height: 50px;
      background-color: #3E67B1;
      box-shadow: 0 0 10px gray;
    }
    body > .header > .header-left > a {
      display: flex;
      align-items: center;
      font-size: 20px;
      font-weight: bold;
      text-decoration: none;
      color: #18263F;;
      transition: .3s;
    }
    body > .header > .header-left > a:active,
    body > .header > .header-left > a:hover {
      text-shadow: 0 0 16px lightgray;
    }
    body > .header > .header-right > a {
      transition: .3s;
    }
    body > .header > .header-right > a:active,
    body > .header > .header-right > a:hover {
      filter: drop-shadow(0 0 8px lightgray);
    }
  </style>

  <script>
    var require = { paths: { vs: './monaco/min/vs' } }
  </script>
  <link
    rel='stylesheet'
    data-name='vs/editor/editor.main'
    href='/monaco/min/vs/editor/editor.main.css'
  >
  <script src='/monaco/min/vs/loader.js'></script>
  <script src='/monaco/min/vs/editor/editor.main.nls.js'></script>
  <script src='/monaco/min/vs/editor/editor.main.js'></script>

  <template id='message-template'>
    <div class='message'>
      {{content}}
    </div>
  </template>
  <script data-name='lib'>
    ;(function () {
      const tmplCache = {}
      /**
       * create a template from a template node
       *
       * @param {string} tmplId
       * @param {Record<string, any>} data
       * @returns {Element}
       */
      window.createEleByTmpl = function (tmplId, data) {
        const tmpl = tmplCache[tmplId] || (tmplCache[tmplId] = document.getElementById(tmplId).innerHTML.trim())

        const div = document.createElement('div')
        div.innerHTML = Object.keys(data).reduce((acc, key) => {
          return acc.replace(new RegExp(`{{${key}}}`, 'g'), data[key])
        }, tmpl)
        return div.children[0]
      }
      window.copyToClipboard = function (content) {
        const input = document.createElement('input')
        input.value = content
        document.body.appendChild(input)
        input.select()
        document.execCommand('copy')
        document.body.removeChild(input)
      }
      window.base64 = function (str, isDecode = true) {
        return isDecode ? decodeURIComponent(atob(str)) : btoa(encodeURIComponent(str))
      }
      window.throttle = function (fn, delay) {
        let timer = null
        return function (...args) {
          if (timer) return
          timer = setTimeout(() => {
            fn.apply(this, args)
            timer = null
          }, delay)
        }
      }
      window.debounce = function (fn, delay) {
        let timer = null
        return function (...args) {
          if (timer) clearTimeout(timer)
          timer = setTimeout(() => {
            fn.apply(this, args)
            timer = null
          }, delay)
        }
      }
      let messages = []
      /**
       * display a message
       * @param {string} content
       * @param {number} duration
       */
      window.showMessage = function (content, duration = 3000) {
        const message = createEleByTmpl('message-template', { content })
        // compute message top
        const top = messages.reduce((acc, msg) => {
          return acc + msg.offsetHeight + 10
        }, 10)
        message.style.top = top + 'px'
        document.body.appendChild(message)
        messages.push(message)
        setTimeout(() => {
          message.classList.add('show')
        }, 0)
        setTimeout(() => {
          message.classList.remove('show')
          setTimeout(() => {
            document.body.removeChild(message)
            messages = messages.filter((m) => m !== message)
          }, 300)
        }, duration)
      }
    })()
  </script>

  <script>
    const ZOD_DTS_FILES = <%- ZOD_DTS_FILES %>;
  </script>
  <script data-name='monaco' type='module' src='/src/monaco.ts'></script>
</head>
<body>
  <div class='header'>
    <div class='header-left'>
      <a href='/'>
        <img src='/zodui.svg'
             alt='ZodUI'
             width='48'
             height='48'
        >
        &nbsp;
        Zod&nbsp;<span style='color: white'>UI</span>
      </a>
    </div>
    <div class='header-right'>
      <a href='https://github.com/zodui/zodui' target='_blank' style='display: flex'>
        <img src='https://github.githubassets.com/favicons/favicon.svg'
             alt='GitHub ZodUI Repsitory'
             width='28'
             height='28'
        >
      </a>
    </div>
  </div>
  <div id='container'></div>
  <div id='root'></div>
  <script type='module' src='/src/main.tsx'></script>
</body>
</html>
